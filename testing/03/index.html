<!doctype html>
<html>
  <head>
    <script src="../../lib/box2d.js"></script>
    <script>
    window.requestAnimFrame = (function(){
          return  window.requestAnimationFrame       || 
                  window.webkitRequestAnimationFrame || 
                  window.mozRequestAnimationFrame    || 
                  window.oRequestAnimationFrame      || 
                  window.msRequestAnimationFrame     || 
                  function(/* function */ callback, /* DOMElement */ element){
                    window.setTimeout(callback, 1000 / 60);
                  };
    })();
    </script>
    <script>
    
    /*
      Create a ball.  Add a table thing.  Let it drop.
      
      To be fair, most of this is copied from http://blog.sethladd.com/2011/09/box2d-javascript-example-walkthrough.html
    */
    
    var world;
    var gravityVector = new Box2D.Common.Math.b2Vec2(0, 10);
    var SCALE = 30;
    
    window.addEventListener("deviceorientation", function(e) {
      gravityVector.x = (e.gamma / 90) * 10;
    }, false);
    
    var update = function() {
      world.SetGravity(gravityVector);
        
      world.Step(
         1 / 60   //frame-rate
         ,  10    //velocity iterations
         ,  10    //position iterations
      );
      
      world.DrawDebugData();
      world.ClearForces();
      requestAnimFrame(update);
    };
    </script>
  </head>
  <body>
    <h1>Gravity Test</h1>
    <canvas id="c" width=640 height=480 style="border: solid black 1px;"></canvas>
  </body>
  <script>
    var canvas = document.getElementById("c");
    var ctx = canvas.getContext("2d");
  
    var init = function() {
        world = new Box2D.Dynamics.b2World(gravityVector, true);
        
        var fFixtureDef = new Box2D.Dynamics.b2FixtureDef;
        fFixtureDef.density = 1.0;
        fFixtureDef.friction = 0.5;
        fFixtureDef.restitution = 0.2;
        fFixtureDef.shape = new Box2D.Collision.Shapes.b2PolygonShape;
        fFixtureDef.shape.SetAsBox((600 / SCALE) / 2, (10/SCALE) / 2);
        
        var fbodyDef = new Box2D.Dynamics.b2BodyDef;
        fbodyDef.type = Box2D.Dynamics.b2Body.b2_staticBody;
        fbodyDef.position.x = canvas.width / 2 / SCALE;
        fbodyDef.position.y = canvas.height / SCALE;
    
        world.CreateBody(fbodyDef).CreateFixture(fFixtureDef);
    };
    
    var createFixtureRow = function() {
        
        /*
          1. Decide how many holes we should have.
          2. Fit the
        */
        
        var holeCount = Math.floor(Math.random() * 2);
        
        var fFixtureDef = new Box2D.Dynamics.b2FixtureDef;
        fFixtureDef.density = 1.0;
        fFixtureDef.friction = 0.5;
        fFixtureDef.restitution = 0.2;
        fFixtureDef.shape = new Box2D.Collision.Shapes.b2PolygonShape;
        fFixtureDef.shape.SetAsBox((600 / SCALE) / 2, (10/SCALE) / 2);
        
        var fbodyDef = new Box2D.Dynamics.b2BodyDef;
        fbodyDef.type = Box2D.Dynamics.b2Body.b2_staticBody;
        fbodyDef.position.x = canvas.width / 2 / SCALE;
        fbodyDef.position.y = canvas.height / SCALE;
    
        world.CreateBody(fbodyDef).CreateFixture(fFixtureDef);
    };
  
    init();
    requestAnimFrame(update);
  </script>
</html>